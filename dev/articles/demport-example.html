<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>DemPoRT example: Survival analysis workflow • MockData</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="demport-example_files/libs/quarto-html/popper.min.js"></script><script src="demport-example_files/libs/quarto-html/tippy.umd.min.js"></script><link href="demport-example_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="demport-example_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="DemPoRT example: Survival analysis workflow">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MockData</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting started with MockData</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-config-files.html">Generating datasets from configuration files</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-dates.html">Working with date variables</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-missing-data.html">Missing data in health surveys</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-garbage-data.html">Generating garbage data for validation testing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>How-to guides</h6></li>
    <li><a class="dropdown-item" href="../articles/cchs-example.html">CCHS example</a></li>
    <li><a class="dropdown-item" href="../articles/chms-example.html">CHMS example</a></li>
    <li><a class="dropdown-item" href="../articles/demport-example.html">DemPoRT example: Survival analysis workflow</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Explanation</h6></li>
    <li><a class="dropdown-item" href="../articles/dates.html">Date variables and temporal data</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-topics.html">Advanced topics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Reference</h6></li>
    <li><a class="dropdown-item" href="../articles/reference-config.html">Configuration reference</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Big-Life-Lab/MockData/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>DemPoRT example: Survival analysis workflow</h1>




      <small class="dont-index">Source: <a href="https://github.com/Big-Life-Lab/MockData/blob/create-date-var/vignettes/demport-example.qmd" class="external-link"><code>vignettes/demport-example.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div style="padding: 1em; background-color: #e3f2fd; border-left: 4px solid #2196F3; margin-bottom: 1em;">
<p><strong>About this vignette:</strong> All numeric values shown in this vignette are computed from the actual DemPoRT metadata files. Code is hidden by default for readability, but you can view the source <code>.qmd</code> file to see how values are calculated.</p>
</div>
<section class="level2"><h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates generating mock data for <strong>DemPoRT</strong> (Dementia Population Risk Tool), a survival analysis model predicting dementia risk. DemPoRT uses harmonized data from multiple Canadian Community Health Survey (CCHS) cycles spanning 2001-2018. Dementia incidence (onset) is individually linked using administrative data housed at ICES – along with mortality records and other censoring information, where it is combined with CCHS survey data.</p>
<p><strong>The MockData workflow for multi-cycle projects:</strong></p>
<ol type="1">
<li>
<strong>Generate separate mock datasets</strong> for individual cycles/databases (e.g., CCHS 2001, CCHS 2003)</li>
<li>
<strong>Hand off to analyst</strong> to test harmonization pipeline (using recodeflow/cchsflow)</li>
<li>
<strong>Harmonize and bind</strong> the individual datasets using your analysis code</li>
<li>
<strong>Calculate derived variables</strong> after harmonization</li>
</ol>
<p>MockData generates <strong>raw, unharmonized data</strong> that mimics individual source databases. It does NOT pool or bind data—that is the analyst’s responsibility to test.</p>
<p><strong>What you’ll learn:</strong></p>
<ul>
<li>Generate mock data for individual survey cycles</li>
<li>Understand multi-cycle metadata structure</li>
<li>Test harmonization workflows with mock data</li>
<li>Validate metadata consistency</li>
<li>Generate survival analysis variables (dates, events)</li>
</ul>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>
<a href="getting-started.html">Getting started</a> - Basic mock data generation</li>
<li>
<a href="tutorial-config-files.html">Configuration files</a> - Batch generation approach</li>
<li>
<a href="dates.html">Date variables</a> - Temporal data and survival analysis</li>
</ul></section><section class="level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Load required packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://big-life-lab.github.io/MockData/">MockData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="required-inputs">Required inputs<a class="anchor" aria-label="anchor" href="#required-inputs"></a>
</h2>
<p>Typically, you need three configuration files to generate mock data:</p>
<ol type="1">
<li>
<strong>Mock data config file</strong> (<code>mock_data_config.csv</code>): Specifies which variables to generate and their roles</li>
<li>
<strong>Variables file</strong> (<code>variables.csv</code>): Defines variable metadata (labels, types, cycles)</li>
<li>
<strong>Variable details file</strong> (<code>variable_details.csv</code>): Specifies distributions and categories</li>
</ol>
<p><strong>Note</strong>: The mock data config file is not yet complete for DemPoRT. This example demonstrates generating mock data directly from harmonization metadata (variables and variable_details files). We will update this vignette once the mock data config is available.</p>
<p>For DemPoRT, the harmonization metadata describes <strong>20+ individual CCHS cycles</strong> (2001-2018):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load DemPoRT metadata</span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/demport/variables_DemPoRT.csv"</span>, package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  header <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  check.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"N/A"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">variable_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/demport/variable_details_DemPoRT.csv"</span>, package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  header <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  check.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"N/A"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>The DemPoRT metadata includes 74 variables with 669 detail rows. First 5 variables: ADL_01, ADL_02, ADL_03, ADL_04, ADL_05.</p>
<p><strong>Variable types in the metadata:</strong></p>
<ul>
<li>
<strong>Categorical</strong>: Sex, education, marital status, immigration status</li>
<li>
<strong>Continuous</strong>: Age, BMI, alcohol consumption</li>
<li>
<strong>Date</strong>: Birth date, interview date (baseline), death date (outcome)</li>
<li>
<strong>Derived</strong>: Age groups, BMI categories (calculated from raw variables)</li>
</ul>
<p><strong>Important</strong>: The metadata describes <strong>harmonized target variables</strong>, not raw source data. MockData uses this metadata to generate mock data that mimics <strong>raw source databases</strong> before harmonization.</p>
<p><strong>Multi-cycle structure</strong>: Each variable’s metadata includes a <code>databaseStart</code> column listing which cycles contain that variable (e.g., “cchs2001_p, cchs2003_p, cchs2005_p”).</p>
</section><section class="level2"><h2 id="generate-mock-data">Generate mock data<a class="anchor" aria-label="anchor" href="#generate-mock-data"></a>
</h2>
<p>The simplest way to generate DemPoRT mock data is using <code><a href="../reference/create_mock_data.html">create_mock_data()</a></code>. This function reads the metadata files and generates all variables at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate mock data for all DemPoRT raw variables</span></span>
<span><span class="co"># Derived variables are automatically excluded</span></span>
<span><span class="va">mock_demport</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_mock_data.html">create_mock_data</a></span><span class="op">(</span></span>
<span>  config_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/demport/variables_DemPoRT.csv"</span>, package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  details_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/demport/variable_details_DemPoRT.csv"</span>, package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">)</span></span>
<span><span class="co"># [1] 100  69</span></span>
<span></span>
<span><span class="co"># First few columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co"># [1] "ADL_01" "ADL_02" "ADL_03" "ADL_04" "ADL_05"</span></span>
<span></span>
<span><span class="co"># Show sample of first 3 rows, first 5 columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#   ADL_01         ADL_02         ADL_03    ADL_04    ADL_05</span></span>
<span><span class="co"># 1 No difficulty  No difficulty  No help   No help   No help</span></span>
<span><span class="co"># 2 Some difficulty No difficulty  No help   No help   Some help</span></span>
<span><span class="co"># 3 No difficulty  No difficulty  No help   No help   No help</span></span></code></pre></div>
</div>
<p><strong>Important: Derived variables are NOT generated</strong></p>
<p>MockData automatically excludes derived variables during generation. Derived variables (e.g., <code>ADL_der</code>, <code>HWTGBMI_der</code>, <code>pack_years_der</code>) are calculated from raw variables and should NOT be generated as mock data.</p>
<p><strong>How it works:</strong></p>
<ol type="1">
<li>Variables with <code>role = "derived,enabled"</code> are automatically filtered out</li>
<li>Only raw variables (e.g., <code>ADL_01</code>, <code>HWTGHTM</code>, <code>HWTGWTK</code>) are generated. This includes raw variables required to calculate derived variables.</li>
<li>You calculate derived variables using your analysis pipeline after generation.</li>
</ol>
<p><strong>Why this matters:</strong></p>
<ul>
<li>
<strong>Consistency</strong>: Derived variables use the same calculation logic as your real analysis</li>
<li>
<strong>Testing</strong>: Test your derived variable calculations on mock data</li>
<li>
<strong>Correctness</strong>: Prevents generating fake derived values that don’t match raw inputs</li>
</ul></section><section class="level2"><h2 id="understanding-multi-cycle-data">Understanding multi-cycle data<a class="anchor" aria-label="anchor" href="#understanding-multi-cycle-data"></a>
</h2>
<p>DemPoRT harmonizes and pools data from multiple CCHS cycles. The harmonization metadata specifies which cycles contain each variable via the <code>databaseStart</code> column.</p>
<p><strong>Key concept</strong>: MockData generates individual cycle datasets (e.g., mock CCHS 2001, mock CCHS 2003). The analyst then:</p>
<ol type="1">
<li>Harmonizes each cycle separately using recodeflow/cchsflow</li>
<li>Binds the harmonized cycles together</li>
<li>Calculates derived variables on the pooled dataset</li>
</ol>
<section class="level3"><h3 id="extract-cycle-information">Extract cycle information<a class="anchor" aria-label="anchor" href="#extract-cycle-information"></a>
</h3>
<p>DemPoRT harmonizes 26 CCHS cycles ranging from 2001 to 2017-2018. The cycles are: cchs2001_i, cchs2001_p, cchs20013_2014_i, cchs2003_i, cchs2003_p, cchs2005_i, cchs2005_p, cchs2007_2008_i, cchs2007_2008_p, cchs2009_2010_i, cchs2009_2010_p, cchs2009_s, cchs2010_p, cchs2010_s, cchs2011_2012_i, cchs2011_2012_p, cchs2012_p, cchs2012_s, cchs2013_2014_i, cchs2013_2014_p, cchs2014_p, cchs2015_2016_i, cchs2015_2016_p, cchs2017_2018, cchs2017_2018_i, cchs2017_2018_p.</p>
<p><strong>Interpretation:</strong></p>
<ul>
<li>Each variable may appear in <strong>different subsets</strong> of cycles</li>
<li>Example: <code>EDU_04</code> (education) appears in cycles 2001-2014, but not 2015-2018</li>
</ul></section><section class="level3"><h3 id="check-variable-coverage-by-cycle">Check variable coverage by cycle<a class="anchor" aria-label="anchor" href="#check-variable-coverage-by-cycle"></a>
</h3>
<p>The EDU_04 (education) variable is available in 0 cycles. First 3: .</p>
<p><strong>Why this matters for MockData:</strong></p>
<ul>
<li>Generate separate mock datasets for each cycle you want to test</li>
<li>Each cycle will have different variables based on <code>databaseStart</code> metadata</li>
<li>Test your harmonization pipeline on individual cycles before pooling</li>
<li>Missing data patterns may differ by cycle</li>
</ul></section></section><section class="level2"><h2 id="validate-metadata-consistency">Validate metadata consistency<a class="anchor" aria-label="anchor" href="#validate-metadata-consistency"></a>
</h2>
<p>Before generating mock data, it’s good practice to check that your config and details files are aligned.</p>
<p>The metadata includes 74 variables in config and 80 variables in details. Warning: 6 variables missing details. Warning: 12 extra variables in details.</p>
<p><strong>Common issues this catches:</strong></p>
<ul>
<li>Typos in variable names</li>
<li>Variables defined in config but missing implementation details</li>
<li>Orphaned details rows from deleted variables</li>
<li>Helpful for troubleshooting <code><a href="../reference/create_mock_data.html">create_mock_data()</a></code> errors</li>
</ul></section><section class="level2"><h2 id="classify-variables-by-type">Classify variables by type<a class="anchor" aria-label="anchor" href="#classify-variables-by-type"></a>
</h2>
<p>Understanding variable types helps organize analysis and identify which variables need special handling.</p>
<p><strong>Variable type summary:</strong></p>
<ul>
<li>Derived: 7</li>
<li>Categorical: 47</li>
<li>Continuous: 20</li>
<li>Total: 74</li>
</ul>
<p>Classification accounts for all variables.</p>
<p><strong>About derived variables:</strong></p>
<ul>
<li>Examples: <code>age_cat</code> (age groups), <code>bmi_cat</code> (BMI categories)</li>
<li>These are <strong>calculated</strong> from raw variables (age, BMI) after harmonization</li>
<li>Should <strong>not</strong> be generated as raw mock data</li>
<li>In real workflows, you’d calculate them using recodeflow after generating raw variables</li>
</ul></section><section class="level2"><h2 id="examine-data-quality-for-individual-cycles">Examine data quality for individual cycles<a class="anchor" aria-label="anchor" href="#examine-data-quality-for-individual-cycles"></a>
</h2>
<p>After generating mock data for an individual cycle, check variable completeness and data types.</p>
<p><strong>Remember</strong>: You’re examining <strong>one cycle’s raw data</strong> here, not pooled data. Each cycle may have different variables and different data patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Check mock data for CCHS 2001</span></span>
<span><span class="co"># (Replace mock_demport with your cycle-specific dataset, e.g., mock_2001)</span></span>
<span></span>
<span><span class="co"># Check for date variables</span></span>
<span><span class="va">date_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mock_demport</span>, <span class="va">inherits</span>, <span class="st">"Date"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Date variables in this cycle:\n"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">date_vars</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">date_vars</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">date_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">n_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s: %s to %s (%d missing)\n"</span>,</span>
<span>                <span class="va">var</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                <span class="va">n_missing</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  (No date variables in this cycle)\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check for factor variables</span></span>
<span><span class="va">factor_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mock_demport</span>, <span class="va">is.factor</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nFactor variables:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">factor_vars</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">factor_vars</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  First 3:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">factor_vars</span>, <span class="fl">3</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Show levels for first factor</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s levels: %s\n"</span>,</span>
<span>              <span class="va">factor_vars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">[[</span><span class="va">factor_vars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example output:</span></span>
<span><span class="co"># Factor variables: 8</span></span>
<span><span class="co">#   First 3: DHH_SEX, EDU_04, SMK_202</span></span>
<span><span class="co">#   DHH_SEX levels: Male, Female</span></span>
<span></span>
<span><span class="co"># Check for numeric variables</span></span>
<span><span class="va">numeric_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mock_demport</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nNumeric variables:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">numeric_vars</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">numeric_vars</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  First 3:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">numeric_vars</span>, <span class="fl">3</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example output:</span></span>
<span><span class="co"># Numeric variables: 12</span></span>
<span><span class="co">#   First 3: ADL_01, ADL_02, HWTDHTM</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="practical-workflow-generate-individual-cycle-datasets">Practical workflow: Generate individual cycle datasets<a class="anchor" aria-label="anchor" href="#practical-workflow-generate-individual-cycle-datasets"></a>
</h2>
<p>MockData generates <strong>separate datasets for individual cycles</strong>. You do NOT bind them together in MockData - that’s the analyst’s job to test harmonization.</p>
<p><strong>Recommended workflow:</strong></p>
<section class="level3"><h3 id="step-1-filter-metadata-for-each-cycle">Step 1: Filter metadata for each cycle<a class="anchor" aria-label="anchor" href="#step-1-filter-metadata-for-each-cycle"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Create cycle-specific metadata files</span></span>
<span><span class="co"># Filter variables and details by databaseStart column</span></span>
<span></span>
<span><span class="co"># CCHS 2001</span></span>
<span><span class="va">vars_2001</span> <span class="op">&lt;-</span> <span class="va">variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">databaseStart</span>, <span class="st">"cchs2001"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">details_2001</span> <span class="op">&lt;-</span> <span class="va">variable_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">vars_2001</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save cycle-specific metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">vars_2001</span>, <span class="st">"demport_variables_2001.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">details_2001</span>, <span class="st">"demport_details_2001.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Repeat for other cycles...</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="step-2-generate-mock-data-for-each-cycle">Step 2: Generate mock data for each cycle<a class="anchor" aria-label="anchor" href="#step-2-generate-mock-data-for-each-cycle"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate separate mock dataset for CCHS 2001</span></span>
<span><span class="va">mock_2001</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_mock_data.html">create_mock_data</a></span><span class="op">(</span></span>
<span>  config_path <span class="op">=</span> <span class="st">"demport_variables_2001.csv"</span>,</span>
<span>  details_path <span class="op">=</span> <span class="st">"demport_details_2001.csv"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">2001</span>  <span class="co"># Cycle-specific seed for reproducibility</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate separate mock dataset for CCHS 2003</span></span>
<span><span class="va">mock_2003</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_mock_data.html">create_mock_data</a></span><span class="op">(</span></span>
<span>  config_path <span class="op">=</span> <span class="st">"demport_variables_2003.csv"</span>,</span>
<span>  details_path <span class="op">=</span> <span class="st">"demport_details_2003.csv"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">2003</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MockData STOPS here - hand off to analyst</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="step-3-test-harmonization-analysts-job">Step 3: Test harmonization (analyst’s job)<a class="anchor" aria-label="anchor" href="#step-3-test-harmonization-analysts-job"></a>
</h3>
<p>After generating individual cycle datasets, you’ll harmonize them using your harmonization pipeline (e.g., recodeflow/cchsflow), bind the harmonized cycles together, and calculate derived variables. Good luck!</p>
<p><strong>Key principles:</strong></p>
<ol type="1">
<li>
<strong>MockData generates</strong>: Individual raw cycle datasets (separate files/objects)</li>
<li>
<strong>Analyst harmonizes</strong>: Each cycle using recodeflow/cchsflow</li>
<li>
<strong>Analyst binds</strong>: Harmonized cycles together for analysis</li>
<li>
<strong>Analyst calculates</strong>: Derived variables on pooled data</li>
</ol>
<p><strong>Why separate cycles matter:</strong></p>
<ul>
<li>Tests harmonization logic on realistic raw data structure</li>
<li>Allows cycle-specific sample sizes (CCHS 2001 = 130K, CCHS 2017 = 110K)</li>
<li>Enables testing cycle-specific missing patterns</li>
<li>Matches real workflow: harmonize first, then pool</li>
</ul></section></section><section class="level2"><h2 id="survival-analysis-dates">Survival analysis dates<a class="anchor" aria-label="anchor" href="#survival-analysis-dates"></a>
</h2>
<p>DemPoRT is a survival model predicting time to dementia diagnosis. This section demonstrates how to generate realistic survival dates with proper temporal ordering and competing risks.</p>
<section class="level3"><h3 id="date-variables-for-survival-analysis">Date variables for survival analysis<a class="anchor" aria-label="anchor" href="#date-variables-for-survival-analysis"></a>
</h3>
<p>The table below shows the date variables in temporal order. The survival analysis focuses on the three key dates: <strong>interview</strong> (cohort entry), <strong>dementia onset</strong> (primary outcome), and <strong>death</strong> (competing risk). Birth date is included in the metadata for age calculation but is not required for the survival analysis itself.</p>
<table class="table caption-top">
<colgroup>
<col style="width: 16%">
<col style="width: 29%">
<col style="width: 19%">
<col style="width: 34%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th>Role in analysis</th>
<th>Date range</th>
<th>Temporal constraint</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>birth_date</code></td>
<td>Age calculation (not used in survival analysis)</td>
<td>1920-1987</td>
<td>birth &lt; interview</td>
</tr>
<tr class="even">
<td><code>interview_date</code></td>
<td><strong>Cohort entry (t=0)</strong></td>
<td>2001-2005</td>
<td>Baseline for all follow-up</td>
</tr>
<tr class="odd">
<td><code>dementia_onset_date</code></td>
<td><strong>Primary outcome</strong></td>
<td>2001-2017</td>
<td>interview &lt; dementia &lt; death</td>
</tr>
<tr class="even">
<td><code>death_date</code></td>
<td><strong>Competing risk</strong></td>
<td>2001-2017</td>
<td>interview &lt; death</td>
</tr>
</tbody>
</table>
<p><strong>Administrative censoring:</strong> End of follow-up is 2017-03-31. Individuals alive at this date are censored.</p>
</section><section class="level3"><h3 id="step-1-generate-survival-dates-with-temporal-ordering">Step 1: Generate survival dates with temporal ordering<a class="anchor" aria-label="anchor" href="#step-1-generate-survival-dates-with-temporal-ordering"></a>
</h3>
<p>The <code><a href="../reference/create_survival_dates.html">create_survival_dates()</a></code> function generates paired entry and event dates with guaranteed temporal ordering. This must be called separately from <code><a href="../reference/create_mock_data.html">create_mock_data()</a></code> because it processes TWO variables together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract metadata for interview (cohort entry) and death (competing risk)</span></span>
<span><span class="va">interview_details</span> <span class="op">&lt;-</span> <span class="va">variable_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"interview_date"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">death_details</span> <span class="op">&lt;-</span> <span class="va">variable_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"death_date"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interview_row</span> <span class="op">&lt;-</span> <span class="va">variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"interview_date"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">death_row</span> <span class="op">&lt;-</span> <span class="va">variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"death_date"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate 1000 individuals with guaranteed temporal ordering</span></span>
<span><span class="va">survival_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_survival_dates.html">create_survival_dates</a></span><span class="op">(</span></span>
<span>  entry_var_row <span class="op">=</span> <span class="va">interview_row</span>,</span>
<span>  entry_details_subset <span class="op">=</span> <span class="va">interview_details</span>,</span>
<span>  event_var_row <span class="op">=</span> <span class="va">death_row</span>,</span>
<span>  event_details_subset <span class="op">=</span> <span class="va">death_details</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">456</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>Verify temporal ordering and date ranges:</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<caption>Generated date ranges and temporal ordering verification</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 37%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Min</th>
<th style="text-align: left;">Max</th>
<th style="text-align: left;">Expected</th>
<th style="text-align: left;">Temporal ordering</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">interview_date</td>
<td style="text-align: left;">2001-01-09</td>
<td style="text-align: left;">2005-12-31</td>
<td style="text-align: left;">2001-2005</td>
<td style="text-align: left;">Baseline (t=0)</td>
</tr>
<tr class="even">
<td style="text-align: left;">death_date</td>
<td style="text-align: left;">2002-07-07</td>
<td style="text-align: left;">2015-10-26</td>
<td style="text-align: left;">2001-2017</td>
<td style="text-align: left;">✓ All &gt;= interview (n=1000)</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section class="level3"><h3 id="step-2-add-competing-risks-dementia-onset">Step 2: Add competing risks (dementia onset)<a class="anchor" aria-label="anchor" href="#step-2-add-competing-risks-dementia-onset"></a>
</h3>
<p>Real survival studies track multiple outcomes. In DemPoRT, two mutually exclusive events can occur:</p>
<ol type="1">
<li>
<strong>Dementia diagnosis</strong> (primary outcome)</li>
<li>
<strong>Death without dementia</strong> (competing risk)</li>
</ol>
<p>We’ll simulate dementia occurring between interview and death for 10% of the cohort:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate dementia incidence (10% develop dementia)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">dementia_occurred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">survival_dates</span><span class="op">)</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  prob <span class="op">=</span> <span class="fl">0.10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For those with dementia, set dementia_onset_date between interview and death</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">dementia_onset_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>  <span class="va">survival_dates</span><span class="op">$</span><span class="va">dementia_occurred</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>  <span class="va">survival_dates</span><span class="op">$</span><span class="va">interview_date</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">survival_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="op">(</span><span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date</span> <span class="op">-</span> <span class="va">survival_dates</span><span class="op">$</span><span class="va">interview_date</span><span class="op">)</span>,</span>
<span>  <span class="cn">NA</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert back to Date class</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">dementia_onset_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span></span>
<span>  <span class="va">survival_dates</span><span class="op">$</span><span class="va">dementia_onset_date</span>,</span>
<span>  origin <span class="op">=</span> <span class="st">"1970-01-01"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="step-3-add-administrative-censoring">Step 3: Add administrative censoring<a class="anchor" aria-label="anchor" href="#step-3-add-administrative-censoring"></a>
</h3>
<p>Not everyone is followed to death in real cohort studies. We apply administrative censoring at 2017-03-31 (end of follow-up):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply censoring: individuals alive after 2017-03-31 are censored</span></span>
<span><span class="va">censor_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-03-31"</span><span class="op">)</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">censored</span> <span class="op">&lt;-</span> <span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date</span> <span class="op">&gt;</span> <span class="va">censor_date</span></span>
<span></span>
<span><span class="co"># Set observed death date (censored individuals get censor_date)</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>  <span class="va">survival_dates</span><span class="op">$</span><span class="va">censored</span>,</span>
<span>  <span class="va">censor_date</span>,</span>
<span>  <span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span></span>
<span>  <span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date_observed</span>,</span>
<span>  origin <span class="op">=</span> <span class="st">"1970-01-01"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="step-4-calculate-time-to-event-and-final-outcomes">Step 4: Calculate time-to-event and final outcomes<a class="anchor" aria-label="anchor" href="#step-4-calculate-time-to-event-and-final-outcomes"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate follow-up time to first event (years)</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">time_to_event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">survival_dates</span><span class="op">$</span><span class="va">dementia_onset_date</span>,</span>
<span>                     <span class="va">survival_dates</span><span class="op">$</span><span class="va">interview_date</span>,</span>
<span>                     units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365.25</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date_observed</span>,</span>
<span>                     <span class="va">survival_dates</span><span class="op">$</span><span class="va">interview_date</span>,</span>
<span>                     units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365.25</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Event type: 0=censored, 1=dementia, 2=death without dementia</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">event_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">survival_dates</span><span class="op">$</span><span class="va">dementia_onset_date</span><span class="op">)</span>, <span class="fl">1</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="va">survival_dates</span><span class="op">$</span><span class="va">censored</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="summary-cohort-characteristics">Summary: Cohort characteristics<a class="anchor" aria-label="anchor" href="#summary-cohort-characteristics"></a>
</h3>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<caption>Final cohort summary: Events, follow-up time, and temporal ordering verification</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 43%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Outcome</th>
<th style="text-align: left;">Event code</th>
<th style="text-align: right;">N</th>
<th style="text-align: left;">Percent</th>
<th style="text-align: left;">Mean follow-up (years)</th>
<th style="text-align: left;">Temporal ordering verified</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Censored</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">0.0%</td>
<td style="text-align: left;">—</td>
<td style="text-align: left;">✓ All interview &lt; censor (n=0)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dementia</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">102</td>
<td style="text-align: left;">10.2%</td>
<td style="text-align: left;">3.0</td>
<td style="text-align: left;">✓ All interview &lt; dementia &lt; death (n=102)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">898</td>
<td style="text-align: left;">89.8%</td>
<td style="text-align: left;">5.6</td>
<td style="text-align: left;">✓ All interview &lt; death (n=898)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The simulated cohort demonstrates realistic survival analysis patterns:</p>
<ul>
<li>
<strong>Temporal ordering:</strong> All dates satisfy the constraint interview &lt; event &lt; death</li>
<li>
<strong>Competing risks:</strong> Individuals experience either dementia or death, not both</li>
<li>
<strong>Censoring:</strong> Individuals alive at study end (2017-03-31) are censored</li>
<li>
<strong>Follow-up time:</strong> Varies by outcome, with censored individuals having longest follow-up</li>
</ul></section><section class="level3"><h3 id="prepare-for-cox-regression-or-competing-risks-analysis">Prepare for Cox regression or competing risks analysis<a class="anchor" aria-label="anchor" href="#prepare-for-cox-regression-or-competing-risks-analysis"></a>
</h3>
<p>The dataset is now ready for survival analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Cox proportional hazards for dementia</span></span>
<span><span class="co"># library(survival)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># model_dementia &lt;- coxph(</span></span>
<span><span class="co">#   Surv(time_to_event, event_type == 1) ~ age + sex + education,</span></span>
<span><span class="co">#   data = survival_dates</span></span>
<span><span class="co"># )</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># # Example: Competing risks analysis</span></span>
<span><span class="co"># library(cmprsk)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># cr_fit &lt;- cuminc(</span></span>
<span><span class="co">#   ftime = survival_dates$time_to_event,</span></span>
<span><span class="co">#   fstatus = survival_dates$event_type,</span></span>
<span><span class="co">#   cencode = 0</span></span>
<span><span class="co"># )</span></span></code></pre></div>
</div>
<p><strong>Key takeaways:</strong></p>
<ol type="1">
<li>
<code><a href="../reference/create_survival_dates.html">create_survival_dates()</a></code> generates entry and event dates with guaranteed temporal ordering</li>
<li>Competing risks (dementia vs death) require additional simulation between entry and event</li>
<li>Administrative censoring is applied based on study design (end date)</li>
<li>All temporal constraints are verified before analysis</li>
<li>The dataset is ready for Cox regression or competing risks models</li>
</ol>
<p><strong>See also:</strong> <a href="dates.html">Date variables tutorial</a> for more on date generation and temporal constraints.</p>
</section></section><section class="level2"><h2 id="visualize-mock-data-optional">Visualize mock data (optional)<a class="anchor" aria-label="anchor" href="#visualize-mock-data-optional"></a>
</h2>
<p>After generating mock data, you can visualize distributions to verify data quality. For example, create histograms for continuous variables (height, weight) or bar charts for categorical variables (sex, education).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Check a continuous variable distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">$</span><span class="va">HWTDHTM</span>,  <span class="co"># Height in cm</span></span>
<span>     breaks <span class="op">=</span> <span class="fl">20</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Height Distribution"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Height (cm)"</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example: Check a categorical variable distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">mock_demport</span><span class="op">$</span><span class="va">DHH_SEX</span><span class="op">)</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Sex Distribution"</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"lightgreen"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>These visualizations help you verify that generated values fall within expected ranges and categories match your metadata specifications.</p>
</section><section class="level2"><h2 id="export-mock-data">Export mock data<a class="anchor" aria-label="anchor" href="#export-mock-data"></a>
</h2>
<p>Save your generated mock data for use in testing your analysis pipeline. You can export to CSV for broad compatibility or RDS to preserve R-specific data types (Date objects, factor levels).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save to CSV (compatible with most tools)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span></span>
<span>  <span class="va">mock_demport</span>,</span>
<span>  <span class="st">"demport_mock_data.csv"</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save to RDS (preserves R data types like Date, factor levels)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span></span>
<span>  <span class="va">mock_demport</span>,</span>
<span>  <span class="st">"demport_mock_data.rds"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>After running these commands, you’ll have two files saved to your working directory: <code>demport_mock_data.csv</code> and <code>demport_mock_data.rds</code>.</p>
</section><section class="level2"><h2 id="what-you-learned">What you learned<a class="anchor" aria-label="anchor" href="#what-you-learned"></a>
</h2>
<p>This vignette demonstrated:</p>
<ol type="1">
<li>
<strong>Batch generation</strong> with <code><a href="../reference/create_mock_data.html">create_mock_data()</a></code> for complex multi-variable datasets</li>
<li>
<strong>Multi-cycle data</strong> concepts and why they matter for survey harmonization</li>
<li>
<strong>Metadata validation</strong> to catch inconsistencies before generation</li>
<li>
<strong>Variable classification</strong> to distinguish raw vs. derived variables</li>
<li>
<strong>Data quality checks</strong> to verify generated data meets expectations</li>
<li>
<strong>Survival analysis setup</strong> including date variables and event indicators</li>
</ol></section><section class="level2"><h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p><strong>Core concepts:</strong></p>
<ul>
<li>
<a href="getting-started.html">Getting started</a> - If you haven’t read this yet</li>
<li>
<a href="tutorial-config-files.html">Configuration files</a> - Deep dive on metadata format</li>
<li>
<a href="dates.html">Date variables</a> - Advanced temporal data and survival workflows</li>
</ul>
<p><strong>Real-world examples:</strong></p>
<ul>
<li>
<a href="cchs-example.html">CCHS example</a> - Canadian Community Health Survey</li>
<li>
<a href="chms-example.html">CHMS example</a> - Canadian Health Measures Survey</li>
</ul>
<p><strong>Advanced topics:</strong></p>
<ul>
<li>
<a href="reference-config.html">Configuration reference</a> - Complete metadata specification</li>
<li>
<a href="advanced-topics.html">Advanced topics</a> - Performance optimization and integration</li>
</ul>
<p><strong>For DemPoRT users:</strong></p>
<ul>
<li>Apply mock data in analysis pipelines</li>
<li>Test harmonization code before accessing real data</li>
<li>Validate survival model implementation</li>
<li>Generate sample datasets for method development</li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>
Developed by Juan Li and recodeflow contributors.
</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
