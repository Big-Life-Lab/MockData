<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Missing data in health surveys • MockData</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="tutorial-missing-data_files/libs/quarto-html/popper.min.js"></script><script src="tutorial-missing-data_files/libs/quarto-html/tippy.umd.min.js"></script><link href="tutorial-missing-data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tutorial-missing-data_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Missing data in health surveys">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MockData</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting started with MockData</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-config-files.html">Generating datasets from configuration files</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-dates.html">Working with date variables</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-missing-data.html">Missing data in health surveys</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-garbage-data.html">Generating garbage data for validation testing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>How-to guides</h6></li>
    <li><a class="dropdown-item" href="../articles/cchs-example.html">CCHS example</a></li>
    <li><a class="dropdown-item" href="../articles/chms-example.html">CHMS example</a></li>
    <li><a class="dropdown-item" href="../articles/demport-example.html">DemPoRT example: Survival analysis workflow</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Explanation</h6></li>
    <li><a class="dropdown-item" href="../articles/dates.html">Date variables and temporal data</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-topics.html">Advanced topics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Reference</h6></li>
    <li><a class="dropdown-item" href="../articles/reference-config.html">Configuration reference</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Big-Life-Lab/MockData/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Missing data in health surveys</h1>




      <small class="dont-index">Source: <a href="https://github.com/Big-Life-Lab/MockData/blob/create-date-var/vignettes/tutorial-missing-data.qmd" class="external-link"><code>vignettes/tutorial-missing-data.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div style="padding: 1em; background-color: #e3f2fd; border-left: 4px solid #2196F3; margin-bottom: 1em;">
<p><strong>About this vignette:</strong> This tutorial teaches you how to generate realistic missing data in mock health survey datasets. You’ll learn why different types of missing data codes matter for statistical analysis and how to handle them correctly in your research.</p>
</div>
<section class="level2"><h2 id="understanding-missing-data-in-health-surveys">Understanding missing data in health surveys<a class="anchor" aria-label="anchor" href="#understanding-missing-data-in-health-surveys"></a>
</h2>
<p>Health surveys use structured missing data codes to distinguish between different types of non-response. Unlike general R data where <code>NA</code> represents any missing value, survey data differentiates between several categories of missingness. This distinction is crucial for accurate statistical analysis.</p>
<p>Consider a simple example: calculating smoking prevalence from survey data. If you treat all missing values the same way, you’ll get biased estimates. Let’s see why.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate smoking data with two approaches</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wrong approach: treating all missing as NA</span></span>
<span><span class="va">smoking_wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  smoker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fl">1000</span>,</span>
<span>                  replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.70</span>, <span class="fl">0.10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correct approach: using survey missing codes</span></span>
<span><span class="va">smoking_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  smoker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"9"</span><span class="op">)</span>, <span class="fl">1000</span>,</span>
<span>                  replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.70</span>, <span class="fl">0.05</span>, <span class="fl">0.03</span>, <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now let’s calculate prevalence both ways:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Wrong calculation (naive approach)</span></span>
<span><span class="va">wrong_prevalence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">smoking_wrong</span><span class="op">$</span><span class="va">smoker</span> <span class="op">==</span> <span class="st">"Yes"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correct calculation (excluding valid skip, including DK/RF/NS in denominator)</span></span>
<span><span class="va">valid_responses</span> <span class="op">&lt;-</span> <span class="va">smoking_correct</span><span class="op">$</span><span class="va">smoker</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"7"</span>, <span class="st">"9"</span><span class="op">)</span></span>
<span><span class="va">correct_prevalence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">smoking_correct</span><span class="op">$</span><span class="va">smoker</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">valid_responses</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The naive approach gives us a prevalence of 22.4%, while the correct approach gives 22%. This difference matters when making population-level estimates or comparing across surveys.</p>
<section class="level3"><h3 id="why-missing-data-codes-matter">Why missing data codes matter<a class="anchor" aria-label="anchor" href="#why-missing-data-codes-matter"></a>
</h3>
<p>In health surveys, not all missing values mean the same thing. The Canadian Community Health Survey (CCHS) and Canadian Health Measures Survey (CHMS) use a standardized system of missing data codes:</p>
<ul>
<li>
<strong>Valid skip (996)</strong>: The question was not asked because skip logic determined it wasn’t applicable</li>
<li>
<strong>Don’t know (997)</strong>: The question was asked but the respondent didn’t know the answer</li>
<li>
<strong>Refusal (998)</strong>: The question was asked but the respondent refused to answer</li>
<li>
<strong>Not stated (999)</strong>: The question was asked but no response was recorded</li>
</ul>
<p>Each type has different statistical implications. Valid skips should be excluded from your denominator (they weren’t part of the eligible population for that question). But don’t know, refusal, and not stated should be included in the denominator when calculating response rates, even though they’re excluded from the numerator when calculating prevalence.</p>
<p>Let’s generate some realistic data to see this in action:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load metadata for examples</span></span>
<span><span class="va">variable_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cchs/variable_details_cchsflow_sample.csv"</span>,</span>
<span>              package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cchs/variables_cchsflow_sample.csv"</span>,</span>
<span>              package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create smoking data with realistic proportions using MockData</span></span>
<span><span class="va">df_mock</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">smoking_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cat_var.html">create_cat_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"SMK_01"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2015_2016_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_mock</span>,</span>
<span>  proportions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="fl">0.18</span>,  <span class="co"># Current smoker</span></span>
<span>    <span class="st">"2"</span> <span class="op">=</span> <span class="fl">0.65</span>,  <span class="co"># Never smoked</span></span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="fl">0.12</span>,  <span class="co"># Former smoker</span></span>
<span>    <span class="st">"6"</span> <span class="op">=</span> <span class="fl">0.01</span>,  <span class="co"># Valid skip</span></span>
<span>    <span class="st">"7"</span> <span class="op">=</span> <span class="fl">0.02</span>,  <span class="co"># Don't know</span></span>
<span>    <span class="st">"9"</span> <span class="op">=</span> <span class="fl">0.02</span>   <span class="co"># Not stated</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">456</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">smoking_data</span><span class="op">$</span><span class="va">SMK_01</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt; table of extent 0 &gt;</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="the-three-types-of-missing-data-codes">The three types of missing data codes<a class="anchor" aria-label="anchor" href="#the-three-types-of-missing-data-codes"></a>
</h3>
<p>Health surveys categorize missing data into three main types, each requiring different statistical treatment.</p>
<p><strong>Valid skip (code 996)</strong></p>
<p>A valid skip occurs when skip logic determines a question should not be asked. For example, if someone reports they’ve never smoked, they won’t be asked “How many cigarettes per day do you smoke?” This isn’t truly missing data—it’s a logical consequence of their previous answer.</p>
<p>Statistical treatment: Exclude from both the numerator and denominator. These respondents weren’t eligible for the question.</p>
<p><strong>Don’t know / Refusal / Not stated (codes 997, 998, 999)</strong></p>
<p>These codes represent questions that were asked but didn’t receive valid responses:</p>
<ul>
<li>
<strong>997 (Don’t know)</strong>: Respondent was uncertain about the answer</li>
<li>
<strong>998 (Refusal)</strong>: Respondent declined to answer</li>
<li>
<strong>999 (Not stated)</strong>: Question was asked but no response was recorded</li>
</ul>
<p>Statistical treatment: Include in the denominator when calculating response rates (they were eligible and asked), but exclude from the numerator when calculating prevalence (we don’t know their true status).</p>
<p><strong>Not applicable (code 996, sometimes labeled NA::a)</strong></p>
<p>This is similar to valid skip—the question doesn’t apply to the respondent’s situation. The statistical treatment is the same as valid skip.</p>
<p>Let’s demonstrate the difference with a worked example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate response rate (includes DK/RF/NS in denominator)</span></span>
<span><span class="va">asked</span> <span class="op">&lt;-</span> <span class="va">smoking_data</span><span class="op">$</span><span class="va">SMK_01</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"7"</span>, <span class="st">"9"</span><span class="op">)</span></span>
<span><span class="va">valid_response</span> <span class="op">&lt;-</span> <span class="va">smoking_data</span><span class="op">$</span><span class="va">SMK_01</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span><span class="op">)</span></span>
<span><span class="va">response_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">valid_response</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">asked</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate prevalence (excludes valid skip from denominator, excludes DK/NS from numerator)</span></span>
<span><span class="va">current_smoker</span> <span class="op">&lt;-</span> <span class="va">smoking_data</span><span class="op">$</span><span class="va">SMK_01</span> <span class="op">==</span> <span class="st">"1"</span></span>
<span><span class="va">asked_not_skip</span> <span class="op">&lt;-</span> <span class="va">smoking_data</span><span class="op">$</span><span class="va">SMK_01</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"7"</span>, <span class="st">"9"</span><span class="op">)</span></span>
<span><span class="va">prevalence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">current_smoker</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">asked_not_skip</span><span class="op">)</span></span></code></pre></div>
</div>
<p>In this dataset:</p>
<ul>
<li>
<strong>Sample size</strong>: respondents</li>
<li>
<strong>Valid skip</strong>: 0 (not asked due to skip logic)</li>
<li>
<strong>Asked</strong>: 0 (eligible for the question)</li>
<li>
<strong>Response rate</strong>: NaN% (valid responses ÷ asked)</li>
<li>
<strong>Smoking prevalence</strong>: NaN% (current smokers ÷ asked excluding DK/NS)</li>
</ul>
<p>Notice how valid skip (6) doesn’t factor into either calculation—those respondents were never part of the eligible population for this question.</p>
</section><section class="level3"><h3 id="real-world-example-from-cchs">Real-world example from CCHS<a class="anchor" aria-label="anchor" href="#real-world-example-from-cchs"></a>
</h3>
<p>Let’s use actual CCHS metadata to generate realistic missing data patterns. The CCHS uses these same coding schemes across hundreds of variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load CCHS metadata</span></span>
<span><span class="va">variable_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cchs/variable_details_cchsflow_sample.csv"</span>,</span>
<span>              package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at alcohol consumption variable</span></span>
<span><span class="va">alc_details</span> <span class="op">&lt;-</span> <span class="va">variable_details</span><span class="op">[</span><span class="va">variable_details</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"ALC_15"</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">alc_details</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"variable"</span>, <span class="st">"recEnd"</span>, <span class="st">"catLabel"</span>, <span class="st">"catLabelLong"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] variable     recEnd       catLabel     catLabelLong
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>This shows how missing codes appear in actual survey metadata. The <code>recEnd</code> column contains the category values, including both substantive responses (1-4 for frequency categories) and missing data codes (6, 7, 9, 96, 97, 99).</p>
<p>We can use this metadata to generate mock data with realistic proportions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate alcohol consumption data using CCHS patterns</span></span>
<span><span class="va">df_mock_alc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">alcohol_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cat_var.html">create_cat_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ALC_15"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2015_2016_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_mock_alc</span>,</span>
<span>  proportions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="fl">0.15</span>,   <span class="co"># Regular drinker</span></span>
<span>    <span class="st">"2"</span> <span class="op">=</span> <span class="fl">0.35</span>,   <span class="co"># Occasional drinker</span></span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="fl">0.28</span>,   <span class="co"># Infrequent drinker</span></span>
<span>    <span class="st">"4"</span> <span class="op">=</span> <span class="fl">0.15</span>,   <span class="co"># Non-drinker</span></span>
<span>    <span class="st">"6"</span> <span class="op">=</span> <span class="fl">0.01</span>,   <span class="co"># Valid skip</span></span>
<span>    <span class="st">"7"</span> <span class="op">=</span> <span class="fl">0.03</span>,   <span class="co"># Don't know</span></span>
<span>    <span class="st">"9"</span> <span class="op">=</span> <span class="fl">0.03</span>    <span class="co"># Not stated</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">789</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate response rate and prevalence of regular drinking</span></span>
<span><span class="va">asked_alc</span> <span class="op">&lt;-</span> <span class="va">alcohol_data</span><span class="op">$</span><span class="va">ALC_15</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"7"</span>, <span class="st">"9"</span><span class="op">)</span></span>
<span><span class="va">valid_alc</span> <span class="op">&lt;-</span> <span class="va">alcohol_data</span><span class="op">$</span><span class="va">ALC_15</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span><span class="op">)</span></span>
<span><span class="va">response_rate_alc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">valid_alc</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">asked_alc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regular_drinker</span> <span class="op">&lt;-</span> <span class="va">alcohol_data</span><span class="op">$</span><span class="va">ALC_15</span> <span class="op">==</span> <span class="st">"1"</span></span>
<span><span class="va">prevalence_alc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">regular_drinker</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">asked_alc</span><span class="op">)</span></span></code></pre></div>
</div>
<p>For this alcohol consumption variable:</p>
<ul>
<li>
<strong>Response rate</strong>: NaN% (0 valid responses ÷ 0 asked)</li>
<li>
<strong>Regular drinking prevalence</strong>: NaN% (0 regular drinkers ÷ 0 asked)</li>
<li>
<strong>Don’t know responses</strong>: 0 (NaN% of those asked)</li>
<li>
<strong>Not stated</strong>: 0 (NaN% of those asked)</li>
</ul>
<p>This demonstrates how real CCHS data includes measurable proportions of missing data codes, and why distinguishing between them matters for accurate statistical reporting.</p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>
Developed by Juan Li and recodeflow contributors.
</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
