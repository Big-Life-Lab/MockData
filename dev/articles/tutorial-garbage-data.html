<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generating garbage data for validation testing • MockData</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="tutorial-garbage-data_files/libs/quarto-html/popper.min.js"></script><script src="tutorial-garbage-data_files/libs/quarto-html/tippy.umd.min.js"></script><link href="tutorial-garbage-data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tutorial-garbage-data_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Generating garbage data for validation testing">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MockData</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting started with MockData</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-config-files.html">Generating datasets from configuration files</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-dates.html">Working with date variables</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-missing-data.html">Missing data in health surveys</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-garbage-data.html">Generating garbage data for validation testing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>How-to guides</h6></li>
    <li><a class="dropdown-item" href="../articles/cchs-example.html">CCHS example</a></li>
    <li><a class="dropdown-item" href="../articles/chms-example.html">CHMS example</a></li>
    <li><a class="dropdown-item" href="../articles/demport-example.html">DemPoRT example: Survival analysis workflow</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Explanation</h6></li>
    <li><a class="dropdown-item" href="../articles/dates.html">Date variables and temporal data</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-topics.html">Advanced topics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Reference</h6></li>
    <li><a class="dropdown-item" href="../articles/reference-config.html">Configuration reference</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Big-Life-Lab/MockData/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generating garbage data for validation testing</h1>




      <small class="dont-index">Source: <a href="https://github.com/Big-Life-Lab/MockData/blob/create-date-var/vignettes/tutorial-garbage-data.qmd" class="external-link"><code>vignettes/tutorial-garbage-data.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div style="padding: 1em; background-color: #e3f2fd; border-left: 4px solid #2196F3; margin-bottom: 1em;">
<p><strong>About this vignette:</strong> This tutorial teaches you how to generate intentionally invalid “garbage” data for testing validation pipelines. You’ll learn how to create realistic data quality issues across categorical, continuous, date, and survival variables, then verify your validation logic catches them correctly.</p>
</div>
<section class="level2"><h2 id="why-generate-garbage-data">Why generate garbage data?<a class="anchor" aria-label="anchor" href="#why-generate-garbage-data"></a>
</h2>
<p>Data validation is critical for research quality, but how do you know your validation rules actually work? The best approach is to generate mock data with known quality issues, run your validation pipeline, and verify it catches exactly what you expect.</p>
<p>This tutorial focuses on the DemPoRT project’s validation needs. DemPoRT analysts receive large administrative datasets and need robust validation pipelines to catch data quality issues before analysis. By generating mock data with intentional errors, they can:</p>
<ol type="1">
<li>
<strong>Test validation logic</strong> before applying it to real data</li>
<li>
<strong>Document expected error rates</strong> for different quality checks</li>
<li>
<strong>Train new team members</strong> on common data quality patterns</li>
<li>
<strong>Benchmark validation performance</strong> with known error proportions</li>
</ol>
<p>Let’s start with a motivating example. Suppose you’re validating alcohol consumption coding in a health survey dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load CCHS metadata</span></span>
<span><span class="va">variable_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cchs/variable_details_cchsflow_sample.csv"</span>,</span>
<span>              package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cchs/variables_cchsflow_sample.csv"</span>,</span>
<span>              package <span class="op">=</span> <span class="st">"MockData"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate alcohol variable WITHOUT garbage (clean data only)</span></span>
<span><span class="va">df_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">alc_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cat_var.html">create_cat_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ALC_1"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2001_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_clean</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check for invalid codes (valid codes are 1, 2, and 6 for valid skip)</span></span>
<span><span class="va">valid_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"6"</span><span class="op">)</span></span>
<span><span class="va">invalid_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">alc_clean</span><span class="op">$</span><span class="va">ALC_1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_codes</span><span class="op">)</span></span></code></pre></div>
</div>
<p>With clean data generated from metadata, your validation check finds 0 invalid codes. But does your validation logic actually work? Let’s add intentional garbage using the <code>prop_invalid</code> parameter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate alcohol variable WITH garbage using prop_invalid parameter</span></span>
<span><span class="va">df_garbage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">alc_garbage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cat_var.html">create_cat_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ALC_1"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2001_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_garbage</span>,</span>
<span>  prop_invalid <span class="op">=</span> <span class="fl">0.03</span>,  <span class="co"># 3% invalid codes</span></span>
<span>  seed <span class="op">=</span> <span class="fl">456</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run validation check</span></span>
<span><span class="va">invalid_garbage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">alc_garbage</span><span class="op">$</span><span class="va">ALC_1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_codes</span><span class="op">)</span></span>
<span><span class="va">invalid_rate</span> <span class="op">&lt;-</span> <span class="va">invalid_garbage</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">alc_garbage</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now your validation finds 30 invalid codes (3% of records). This matches your expected 3% garbage proportion, confirming your validation logic works correctly.</p>
<p>This pattern—generate garbage, run validation, verify detection—is the foundation of robust data quality testing.</p>
</section><section class="level2"><h2 id="categorical-garbage-patterns">Categorical garbage patterns<a class="anchor" aria-label="anchor" href="#categorical-garbage-patterns"></a>
</h2>
<p>Categorical variables can have several types of garbage data. The most common are:</p>
<p><strong>Invalid codes</strong>: Values that aren’t in the valid category set. Examples: “.a”, “NA”, “missing”, numeric codes outside the defined range.</p>
<p><strong>Type mismatches</strong>: Wrong data types. Example: Numeric codes stored as floats (1.0 instead of 1).</p>
<p><strong>Encoding issues</strong>: Character encoding problems. Example: “Montr0e9al” becomes “Montr”.</p>
<p>MockData uses the <code>prop_invalid</code> parameter to automatically generate invalid category codes for testing validation logic.</p>
<section class="level3"><h3 id="basic-categorical-garbage">Basic categorical garbage<a class="anchor" aria-label="anchor" href="#basic-categorical-garbage"></a>
</h3>
<p>Let’s generate an ADL (Activities of Daily Living) variable with 3% garbage. The <code>prop_invalid</code> parameter tells MockData to generate random invalid codes not found in the metadata:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate ADL variable with 3% invalid codes</span></span>
<span><span class="va">df_adl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">adl_garbage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cat_var.html">create_cat_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ADL_01"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2001_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_adl</span>,</span>
<span>  prop_invalid <span class="op">=</span> <span class="fl">0.03</span>,  <span class="co"># 3% invalid codes</span></span>
<span>  seed <span class="op">=</span> <span class="fl">789</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validation: check for invalid codes</span></span>
<span><span class="co"># Get valid codes from metadata for ADL_01</span></span>
<span><span class="va">adl_details</span> <span class="op">&lt;-</span> <span class="va">variable_details</span><span class="op">[</span><span class="va">variable_details</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"ADL_01"</span> <span class="op">&amp;</span></span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cchs2001_p"</span>, <span class="va">variable_details</span><span class="op">$</span><span class="va">databaseStart</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">valid_adl_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">adl_details</span><span class="op">$</span><span class="va">recEnd</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">adl_details</span><span class="op">$</span><span class="va">recEnd</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check for codes not in metadata</span></span>
<span><span class="va">invalid_adl</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">adl_garbage</span><span class="op">$</span><span class="va">ADL_01</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_adl_codes</span></span>
<span><span class="va">n_invalid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">invalid_adl</span><span class="op">)</span></span>
<span><span class="va">invalid_pct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_invalid</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">adl_garbage</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Validation results:</p>
<ul>
<li>
<strong>Total records</strong>: 2000</li>
<li>
<strong>Invalid codes found</strong>: 60 (3%)</li>
<li>
<strong>Garbage codes detected</strong>: -1, -9, -99, 88, 888, 96, 97, 98, 99, 999, 9999</li>
</ul>
<p>This matches our expected 3% garbage rate, confirming the validation logic correctly identifies invalid codes generated by <code>prop_invalid</code>.</p>
</section></section><section class="level2"><h2 id="continuous-variable-garbage">Continuous variable garbage<a class="anchor" aria-label="anchor" href="#continuous-variable-garbage"></a>
</h2>
<p>Continuous variables have different garbage patterns than categorical variables. Common issues include:</p>
<p><strong>Out-of-range values</strong>: Numbers outside biologically/logically plausible ranges. Example: Age = 250 years.</p>
<p><strong>Type corruption</strong>: Values stored as wrong type. Example: Age stored as character “45.5” instead of numeric.</p>
<p><strong>Precision issues</strong>: Inappropriate decimal places. Example: Age = 45.7829 (overly precise).</p>
<p>MockData uses special recEnd codes to generate continuous garbage:</p>
<ul>
<li>
<strong>corrupt_high</strong>: Values above the valid range</li>
<li>
<strong>corrupt_low</strong>: Values below the valid range</li>
<li>
<strong>corrupt_na</strong>: Missing value indicators stored as numbers (e.g., -999)</li>
</ul>
<section class="level3"><h3 id="out-of-range-values">Out-of-range values<a class="anchor" aria-label="anchor" href="#out-of-range-values"></a>
</h3>
<p>Let’s generate alcohol consumption data (number of drinks on Sunday) with out-of-range garbage. The valid range is 0-50 drinks, so we’ll use <code>prop_invalid</code> to generate values outside this range:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate drinks data with 2% out-of-range garbage</span></span>
<span><span class="va">df_drinks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">drinks_garbage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_con_var.html">create_con_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ALW_2A1"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2001_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_drinks</span>,</span>
<span>  prop_invalid <span class="op">=</span> <span class="fl">0.02</span>,  <span class="co"># 2% out-of-range values</span></span>
<span>  seed <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate: check for out-of-range values</span></span>
<span><span class="co"># Valid range for ALW_2A1 is [0, 50]</span></span>
<span><span class="va">out_of_range</span> <span class="op">&lt;-</span> <span class="va">drinks_garbage</span><span class="op">$</span><span class="va">ALW_2A1</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">drinks_garbage</span><span class="op">$</span><span class="va">ALW_2A1</span> <span class="op">&gt;</span> <span class="fl">50</span></span>
<span><span class="va">n_invalid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">out_of_range</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">invalid_pct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_invalid</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">drinks_garbage</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Validation results:</p>
<ul>
<li>
<strong>Total records</strong>: 2000</li>
<li>
<strong>Out-of-range values</strong>: 20 (1%)</li>
<li>
<strong>Overall range</strong>: 0 to 148.7 drinks</li>
<li>
<strong>Garbage range</strong>: 51.2 to 148.7</li>
</ul>
<p>This confirms the validator correctly identifies out-of-range drink values. The <code>prop_invalid</code> parameter generates values above the maximum (over 50 drinks) for this variable.</p>
</section><section class="level3"><h3 id="testing-multiple-garbage-proportions">Testing multiple garbage proportions<a class="anchor" aria-label="anchor" href="#testing-multiple-garbage-proportions"></a>
</h3>
<p>We can test validation thresholds by generating data with different garbage rates. Let’s create drinks data with 5% invalid values and check how the validator handles higher garbage rates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate drinks data with higher garbage rate</span></span>
<span><span class="va">df_drinks2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">drinks_garbage2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_con_var.html">create_con_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ALW_2A1"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2001_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_drinks2</span>,</span>
<span>  prop_invalid <span class="op">=</span> <span class="fl">0.05</span>,  <span class="co"># 5% out-of-range values</span></span>
<span>  seed <span class="op">=</span> <span class="fl">201</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate: check for out-of-range values</span></span>
<span><span class="va">excessive_drinks</span> <span class="op">&lt;-</span> <span class="va">drinks_garbage2</span><span class="op">$</span><span class="va">ALW_2A1</span> <span class="op">&gt;</span> <span class="fl">50</span></span>
<span><span class="va">n_excessive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">excessive_drinks</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The validator detects:</p>
<ul>
<li>
<strong>Excessive drinks (&gt;50)</strong>: 50 (2.5%)</li>
<li>
<strong>Maximum excessive</strong>: 149.8</li>
</ul>
<p>With a higher garbage rate (5%), validators detect more invalid values, allowing you to test how your validation pipeline handles varying levels of data quality issues.</p>
</section></section><section class="level2"><h2 id="date-variable-garbage">Date variable garbage<a class="anchor" aria-label="anchor" href="#date-variable-garbage"></a>
</h2>
<p>Date variables can also use the <code>prop_invalid</code> parameter to generate dates outside specified ranges. For date variables, <code>prop_invalid</code> generates dates 1-5 years before or after the valid range, making them clearly invalid for validation testing.</p>
<p>The date garbage generation works the same way as continuous variables—you specify the proportion of invalid values and the function automatically generates out-of-range dates for testing validators.</p>
</section><section class="level2"><h2 id="survival-data-garbage">Survival data garbage<a class="anchor" aria-label="anchor" href="#survival-data-garbage"></a>
</h2>
<p>Survival analysis requires coordinated date validation across multiple time points. Garbage data helps test the complex validation rules for temporal consistency.</p>
<p>Common survival data quality issues:</p>
<p><strong>Date sequence violations</strong>: Death before birth, death before interview</p>
<p><strong>Impossible survival times</strong>: Negative follow-up time, follow-up exceeding study period</p>
<p><strong>Censoring inconsistencies</strong>: Status indicates death but no death date recorded</p>
<section class="level3"><h3 id="survival-garbage-without-config">Survival garbage without config<a class="anchor" aria-label="anchor" href="#survival-garbage-without-config"></a>
</h3>
<p>For survival data, <code><a href="../reference/create_survival_dates.html">create_survival_dates()</a></code> supports the <code>prop_invalid</code> parameter to generate temporal violations (entry date &gt; event date):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate survival dates with 3% temporal violations</span></span>
<span><span class="va">survival_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_survival_dates.html">create_survival_dates</a></span><span class="op">(</span></span>
<span>  entry_var <span class="op">=</span> <span class="st">"study_entry"</span>,</span>
<span>  event_var <span class="op">=</span> <span class="st">"death_date"</span>,</span>
<span>  entry_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2015-01-01"</span><span class="op">)</span>,</span>
<span>  entry_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2016-12-31"</span><span class="op">)</span>,</span>
<span>  followup_min <span class="op">=</span> <span class="fl">30</span>,      <span class="co"># Minimum 30 days</span></span>
<span>  followup_max <span class="op">=</span> <span class="fl">3650</span>,    <span class="co"># Maximum 10 years</span></span>
<span>  length <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prop_invalid <span class="op">=</span> <span class="fl">0.03</span>,    <span class="co"># 3% temporal violations</span></span>
<span>  seed <span class="op">=</span> <span class="fl">400</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate: entry should occur before event (death)</span></span>
<span><span class="va">temporal_violations</span> <span class="op">&lt;-</span> <span class="va">survival_dates</span><span class="op">$</span><span class="va">study_entry</span> <span class="op">&gt;</span> <span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date</span></span>
<span><span class="va">n_violations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">temporal_violations</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Validation detects 60 temporal violations (3%), matching our 3% garbage specification.</p>
<p>When <code>prop_invalid</code> is specified, <code><a href="../reference/create_survival_dates.html">create_survival_dates()</a></code> swaps entry and event dates for the specified proportion of records, creating realistic temporal violations for validator testing.</p>
</section><section class="level3"><h3 id="testing-follow-up-time-calculations">Testing follow-up time calculations<a class="anchor" aria-label="anchor" href="#testing-follow-up-time-calculations"></a>
</h3>
<p>Temporal violations also produce invalid derived variables like negative follow-up time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate follow-up time in days (entry to event)</span></span>
<span><span class="va">survival_dates</span><span class="op">$</span><span class="va">followup_days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span></span>
<span>    <span class="va">survival_dates</span><span class="op">$</span><span class="va">death_date</span>,</span>
<span>    <span class="va">survival_dates</span><span class="op">$</span><span class="va">study_entry</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"days"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate: follow-up should be non-negative</span></span>
<span><span class="va">negative_followup</span> <span class="op">&lt;-</span> <span class="va">survival_dates</span><span class="op">$</span><span class="va">followup_days</span> <span class="op">&lt;</span> <span class="fl">0</span></span>
<span><span class="va">n_negative_fu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">negative_followup</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Validation results for derived variables:</p>
<ul>
<li>
<strong>Negative follow-up time</strong>: 60 (3%)</li>
</ul>
<p>The negative follow-up times correspond exactly to our temporal violations, confirming validators catch these derived quality issues.</p>
</section></section><section class="level2"><h2 id="building-a-validation-pipeline">Building a validation pipeline<a class="anchor" aria-label="anchor" href="#building-a-validation-pipeline"></a>
</h2>
<p>Now that we understand individual garbage patterns, let’s build a complete validation pipeline that tests all quality checks systematically. We’ll use MockData functions to generate a dataset with multiple garbage types:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate complete dataset with multiple garbage types using MockData</span></span>
<span><span class="va">df_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 1: Categorical variable with garbage (ALC_1)</span></span>
<span><span class="va">alc_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cat_var.html">create_cat_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ALC_1"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2001_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_full</span>,</span>
<span>  prop_invalid <span class="op">=</span> <span class="fl">0.03</span>,  <span class="co"># 3% invalid codes</span></span>
<span>  seed <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Continuous variable with garbage (ALW_2A1)</span></span>
<span><span class="va">df_full</span> <span class="op">&lt;-</span> <span class="va">alc_full</span></span>
<span><span class="va">drinks_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_con_var.html">create_con_var</a></span><span class="op">(</span></span>
<span>  var_raw <span class="op">=</span> <span class="st">"ALW_2A1"</span>,</span>
<span>  cycle <span class="op">=</span> <span class="st">"cchs2001_p"</span>,</span>
<span>  variable_details <span class="op">=</span> <span class="va">variable_details</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  length <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  df_mock <span class="op">=</span> <span class="va">df_full</span>,</span>
<span>  prop_invalid <span class="op">=</span> <span class="fl">0.02</span>,  <span class="co"># 2% out-of-range</span></span>
<span>  seed <span class="op">=</span> <span class="fl">501</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine into single dataset</span></span>
<span><span class="va">full_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">alc_full</span>, <span class="va">drinks_full</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run validation suite</span></span>
<span><span class="co"># Check 1: Categorical codes</span></span>
<span><span class="va">alc_details</span> <span class="op">&lt;-</span> <span class="va">variable_details</span><span class="op">[</span><span class="va">variable_details</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"ALC_1"</span> <span class="op">&amp;</span></span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cchs2001_p"</span>, <span class="va">variable_details</span><span class="op">$</span><span class="va">databaseStart</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">valid_alc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">alc_details</span><span class="op">$</span><span class="va">recEnd</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">alc_details</span><span class="op">$</span><span class="va">recEnd</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">alc_invalid</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">full_data</span><span class="op">$</span><span class="va">ALC_1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_alc</span></span>
<span></span>
<span><span class="co"># Check 2: Drinks range (valid: 0-50)</span></span>
<span><span class="va">drinks_invalid</span> <span class="op">&lt;-</span> <span class="va">full_data</span><span class="op">$</span><span class="va">ALW_2A1</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">full_data</span><span class="op">$</span><span class="va">ALW_2A1</span> <span class="op">&gt;</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># Check 3: Combined validation (any record with any issue)</span></span>
<span><span class="va">any_issue</span> <span class="op">&lt;-</span> <span class="va">alc_invalid</span> <span class="op">|</span> <span class="va">drinks_invalid</span></span>
<span></span>
<span><span class="co"># Build results table</span></span>
<span><span class="va">validation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ALC_1: invalid codes"</span>, <span class="st">"ALW_2A1: out of range"</span>, <span class="st">"Any validation failure"</span><span class="op">)</span>,</span>
<span>  n_fail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">alc_invalid</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">drinks_invalid</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">any_issue</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  pct_fail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">alc_invalid</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">full_data</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">drinks_invalid</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">full_data</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">any_issue</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">full_data</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="va">validation_results</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   check n_fail pct_fail
1   ALC_1: invalid codes    150     3.00
2  ALW_2A1: out of range     50     1.00
3 Any validation failure    199     3.98</code></pre>
</div>
</div>
<p>This validation suite detects all intentional garbage patterns. The failure rates match our specified proportions (3% for ALC_1, 2% for ALW_2A1), confirming each validator works correctly.</p>
</section><section class="level2"><h2 id="what-you-learned">What you learned<a class="anchor" aria-label="anchor" href="#what-you-learned"></a>
</h2>
<p>In this tutorial, you learned how to:</p>
<ul>
<li>
<strong>Generate categorical garbage data</strong> using the <code>prop_invalid</code> parameter to create invalid codes</li>
<li>
<strong>Create continuous garbage patterns</strong> using the <code>prop_invalid</code> parameter for out-of-range values</li>
<li>
<strong>Test date validation logic</strong> using the <code>prop_invalid</code> parameter for out-of-period dates</li>
<li>
<strong>Add temporal violations in survival data</strong> using the <code>prop_invalid</code> parameter to swap entry and event dates</li>
<li>
<strong>Add explicit garbage with config files</strong> using <code>catLabel::garbage</code> specifications</li>
<li>
<strong>Build comprehensive validation pipelines</strong> that test multiple quality checks systematically</li>
<li>
<strong>Verify validator accuracy</strong> by comparing detected rates to known garbage proportions</li>
</ul>
<p>The key principle: generate mock data with <strong>known</strong> quality issues, run your validators, and confirm they detect <strong>exactly</strong> what you expect. This approach gives you confidence that your validation pipeline will catch real data quality problems in production.</p>
</section><section class="level2"><h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong>Practice with your project</strong>: Generate garbage data matching your specific validation rules</li>
<li>
<strong>Test edge cases</strong>: Create scenarios that stress-test validator boundary conditions</li>
<li>
<strong>Document expected rates</strong>: Use garbage data to establish baseline error rate expectations</li>
<li>
<strong>Automate validation testing</strong>: Integrate garbage data generation into your CI/CD pipeline</li>
</ul>
<p><strong>Related vignettes</strong>:</p>
<ul>
<li>
<a href="demport-example.html">DemPoRT example</a>: See garbage data in a complete DemPoRT workflow</li>
<li>
<a href="tutorial-dates.html">Date variables tutorial</a>: Learn advanced date generation techniques</li>
<li>
<a href="getting-started.html">Getting started</a>: Review MockData fundamentals</li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>
Developed by Juan Li and recodeflow contributors.
</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
